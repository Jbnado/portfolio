---
import ThemeToggle from '../islands/ThemeToggle.tsx';
import MobileNav from '../islands/MobileNav.tsx';
import LanguageSwitcher from './LanguageSwitcher.astro';
import { t, getCvPath } from '../i18n/utils';

interface Props {
  locale?: string;
}

const { locale = 'pt-br' } = Astro.props;

const localePrefix = locale === 'pt-br' ? '' : `/${locale}`;

const navLinks = [
  { href: '#sobre', label: t('nav.about', locale) },
  { href: '#projetos', label: t('nav.projects', locale) },
  { href: '#contacto', label: t('nav.contact', locale) },
];
---

<nav class="navbar" aria-label={t('nav.mainNav', locale)}>
  <div class="navbar-container">
    <!-- Logo -->
    <a href={localePrefix || '/'} class="navbar-logo" aria-label={t('nav.goHome', locale)}>
      jb<span class="navbar-logo-dot">.</span>
    </a>

    <!-- Desktop links -->
    <div class="navbar-links">
      {navLinks.map(({ href, label }) => (
        <a href={href} class="navbar-link">
          {label}
        </a>
      ))}
    </div>

    <!-- Actions -->
    <div class="navbar-actions">
      <a
        href={getCvPath(locale)}
        download
        class="navbar-cv"
        aria-label={t('nav.downloadCv', locale)}
      >
        CV ↓
      </a>
      <LanguageSwitcher locale={locale} />
      <ThemeToggle client:load />
      <MobileNav client:load links={navLinks} cvHref={getCvPath(locale)} />
    </div>
  </div>
</nav>

<script>
  const nav = document.querySelector('.navbar');
  if (nav) {
    const onScroll = () => {
      const scrolled = window.scrollY > 100;
      nav.classList.toggle('scrolled', scrolled);
    };
    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll(); // check initial state
  }
</script>

<style is:global>
  .navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 40;
    transition:
      background-color 200ms ease,
      border-color 200ms ease;
    border-bottom: 1px solid transparent;
  }

  .navbar.scrolled {
    background-color: color-mix(
      in srgb,
      var(--color-bg-primary) 95%,
      transparent
    );
    border-bottom-color: var(--color-border);
    will-change: background-color;
  }

  .navbar-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
  }

  @media (min-width: 768px) {
    .navbar-container {
      padding: 1rem 2rem;
    }
  }

  @media (min-width: 1024px) {
    .navbar-container {
      padding: 1rem 4rem;
    }
  }

  /* Logo */
  .navbar-logo {
    font-family: var(--font-mono);
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-text-primary);
    text-decoration: none;
  }

  .navbar-logo-dot {
    color: var(--color-accent);
    display: inline-block;
  }

  .navbar-logo:hover .navbar-logo-dot {
    animation: pulse-dot 400ms cubic-bezier(0.25, 0.1, 0.25, 1);
  }

  /* Nav links (desktop only) */
  .navbar-links {
    display: none;
    gap: 2rem;
    align-items: center;
  }

  @media (min-width: 1024px) {
    .navbar-links {
      display: flex;
    }
  }

  .navbar-link {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: color 300ms cubic-bezier(0.25, 0.1, 0.25, 1) 100ms;
  }

  .navbar-link:hover {
    color: var(--color-accent);
  }

  .navbar-link::after {
    content: "";
    display: block;
    width: 0;
    height: 1.5px;
    background: var(--color-accent);
    transition: width 150ms cubic-bezier(0.25, 0.1, 0.25, 1);
  }

  .navbar-link.active {
    color: var(--color-accent);
  }

  .navbar-link.active::after {
    width: 100%;
  }

  /* Actions */
  .navbar-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  /* CV button — badge style */
  .navbar-cv {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
    background: var(--color-accent);
    color: #ffffff;
    text-decoration: none;
    transition: background-color 300ms cubic-bezier(0.25, 0.1, 0.25, 1) 100ms;
  }

  .navbar-cv:hover {
    background: var(--color-accent-hover);
  }

  .navbar-cv:active {
    transform: scale(0.98);
  }

  /* Dark mode — punk */
  .dark .navbar-link {
    font-family: var(--font-mono);
    text-shadow: 0 0 8px rgba(162, 119, 255, 0.3);
  }

  .dark .navbar-link:hover {
    color: #61ffca;
    text-shadow: 0 0 12px rgba(97, 255, 202, 0.6);
  }

  .dark .navbar-link:nth-child(even):hover {
    color: #f694ff;
    text-shadow: 0 0 12px rgba(246, 148, 255, 0.6);
  }

  .dark .navbar-logo-dot {
    color: #a277ff;
    text-shadow: 0 0 10px rgba(162, 119, 255, 0.6);
  }

  .dark .navbar::before {
    content: "";
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(
      0deg,
      rgba(162, 119, 255, 0.03) 0px,
      rgba(162, 119, 255, 0.03) 1px,
      transparent 1px,
      transparent 3px
    );
    pointer-events: none;
    z-index: -1;
  }
</style>
